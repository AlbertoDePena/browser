<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>routing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Elmish browser extensions: UrlParser and Navigation"/>
    <meta name="author" content="Eugene Tolmachev"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="https://elmish.github.io/browser/content/style_light.css" />
    <script type="text/javascript" src="https://elmish.github.io/browser/content/tips.js"></script>
    <style>span.l { display: none }</style>
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="https://elmish.github.io">elmish</a></li>
          <li><a href="http://fable.io">fable</a></li>
          <li><a href="http://fsharp.org">fsharp.org</a></li>
        </ul>
        <h3 class="muted"><a href="https://elmish.github.io/browser/index.html">elmish-browser</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h2><a name="Handling-URL-updates-in-your-application" class="anchor" href="#Handling-URL-updates-in-your-application">Handling URL updates in your application</a></h2>
<p>Using <a href="https://elmish.github.io/urlParser">elmish-urlParser</a> let's define the type that's going to represent our routes
and the parser to convert the browser URLs into instances of this type.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="rt">Route</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="uc">Blog</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="vt">int</span> <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="uc">Search</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="rt">string</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="id">route</span> <span class="o">=</span>
    <span class="id">oneOf</span>
        <span class="pn">[</span> <span class="id">map</span> <span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="id">Blog</span> <span class="pn">(</span><span class="id">s</span> <span class="s">&quot;blog&quot;</span> <span class="o">&lt;/&gt;</span> <span class="id">i32</span><span class="pn">)</span>
          <span class="id">map</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="id">Search</span> <span class="pn">(</span><span class="id">s</span> <span class="s">&quot;search&quot;</span> <span class="o">&lt;/&gt;</span> <span class="id">str</span><span class="pn">)</span> <span class="pn">]</span>
</code></pre></td>
</tr>
</table>
<p>To execute the parser we've defined and pass the route as a nice data structure into the update loop
we'll define <code>urlUpdate</code> function that takes the current state and the parsed output, for example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="rt">Model</span> <span class="o">=</span>
  <span class="pn">{</span> <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="id">route</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="rt">Route</span>
    <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="id">query</span> <span class="pn">:</span> <span onmouseout="hideTip(event, 'fs5', 13)" onmouseover="showTip(event, 'fs5', 13)" class="rt">string</span> <span class="pn">}</span>

<span class="k">open</span> <span class="id">Elmish</span><span class="pn">.</span><span class="id">Navigation</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="fn">urlUpdate</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="id">result</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="rt">Option</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs1', 17)" onmouseover="showTip(event, 'fs1', 17)" class="rt">Route</span><span class="pn">&gt;</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs13', 18)" onmouseover="showTip(event, 'fs13', 18)" class="id">model</span> <span class="o">=</span>
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs11', 19)" onmouseover="showTip(event, 'fs11', 19)" class="id">result</span> <span class="k">with</span>
  <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs14', 20)" onmouseover="showTip(event, 'fs14', 20)" class="uc">Some</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs4', 21)" onmouseover="showTip(event, 'fs4', 21)" class="uc">Search</span> <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="id">query</span><span class="pn">)</span> <span class="k">-&gt;</span>
      <span class="pn">{</span> <span onmouseout="hideTip(event, 'fs13', 23)" onmouseover="showTip(event, 'fs13', 23)" class="id">model</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs6', 24)" onmouseover="showTip(event, 'fs6', 24)" class="id">route</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 25)" onmouseover="showTip(event, 'fs11', 25)" class="id">result</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="id">Value</span><span class="pn">;</span> <span onmouseout="hideTip(event, 'fs15', 27)" onmouseover="showTip(event, 'fs15', 27)" class="id">query</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 28)" onmouseover="showTip(event, 'fs15', 28)" class="id">query</span> <span class="pn">}</span><span class="pn">,</span> <span class="pn">[</span><span class="pn">]</span> <span class="c">// Issue some search Cmd instead</span>

  <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs14', 29)" onmouseover="showTip(event, 'fs14', 29)" class="uc">Some</span> <span onmouseout="hideTip(event, 'fs17', 30)" onmouseover="showTip(event, 'fs17', 30)" class="id">page</span> <span class="k">-&gt;</span>
      <span class="pn">{</span> <span onmouseout="hideTip(event, 'fs13', 31)" onmouseover="showTip(event, 'fs13', 31)" class="id">model</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs6', 32)" onmouseover="showTip(event, 'fs6', 32)" class="id">route</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33)" class="id">page</span><span class="pn">;</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="id">query</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="pn">}</span><span class="pn">,</span> <span class="pn">[</span><span class="pn">]</span>

  <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs19', 35)" onmouseover="showTip(event, 'fs19', 35)" class="uc">None</span> <span class="k">-&gt;</span>
      <span class="pn">(</span> <span onmouseout="hideTip(event, 'fs13', 36)" onmouseover="showTip(event, 'fs13', 36)" class="id">model</span><span class="pn">,</span> <span class="id">Navigation</span><span class="pn">.</span><span class="id">modifyUrl</span> <span class="s">&quot;#&quot;</span> <span class="pn">)</span> <span class="c">// no matching route - go home</span>
    
</code></pre></td>
</tr>
</table>
<p>It looks like <code>update</code> function but instead of the message it handles the route changes.
If the URL is valid, we just update our model or issue a command, otherwise we modify the URL to whatever makes sense.</p>
<p>Now we augument our program instance with Navigation capabilities, passing the parser and <code>urlUpdate</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="id">Elmish</span>

<span class="id">Program</span><span class="pn">.</span><span class="id">mkProgram</span> <span class="id">init</span> <span class="id">update</span> <span class="id">view</span>
<span class="o">|&gt;</span> <span class="id">Program</span><span class="pn">.</span><span class="id">toNavigable</span> <span class="pn">(</span><span class="id">parseHash</span> <span onmouseout="hideTip(event, 'fs6', 37)" onmouseover="showTip(event, 'fs6', 37)" class="id">route</span><span class="pn">)</span> <span onmouseout="hideTip(event, 'fs10', 38)" onmouseover="showTip(event, 'fs10', 38)" class="id">urlUpdate</span>
<span class="o">|&gt;</span> <span class="id">Program</span><span class="pn">.</span><span class="id">run</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>Note that the type of the <code>init</code> function has changed - it will now receive the intial URL passed to our SPA!</p>
</blockquote>
<h3><a name="Working-with-full-HTML5-and-hash-based-URLs" class="anchor" href="#Working-with-full-HTML5-and-hash-based-URLs">Working with full (HTML5) and hash-based URLs</a></h3>
<p><code>parseHash</code> function works with "hashbang" URLs, i.e. everything after the '#' symbol, while <code>parsePath</code> works with the entire location.
The query for a hashbang URL never leaves the browser and can appear in traditional tags like <code>&lt;a&gt;</code>.
Working with full URL on the other hand means you have to be careful about which requests you want forwarded to the server and which ones should be handled locally.
To keep the request local you have to use <code>Navigation</code> module for all the URL transitions.</p>
<p>Make sure you understand which one you need.</p>

<div class="tip" id="fs1">type Route =<br />&#160;&#160;| Blog of int<br />&#160;&#160;| Search of string</div>
<div class="tip" id="fs2">union case Route.Blog: int -&gt; Route</div>
<div class="tip" id="fs3">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int</div>
<div class="tip" id="fs4">union case Route.Search: string -&gt; Route</div>
<div class="tip" id="fs5">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />--------------------<br />type string = System.String</div>
<div class="tip" id="fs6">val route : obj</div>
<div class="tip" id="fs7">type Model =<br />&#160;&#160;{route: Route;<br />&#160;&#160;&#160;query: string;}</div>
<div class="tip" id="fs8">Model.route: Route</div>
<div class="tip" id="fs9">Model.query: string</div>
<div class="tip" id="fs10">val urlUpdate : result:Option&lt;Route&gt; -&gt; model:Model -&gt; Model * &#39;a list</div>
<div class="tip" id="fs11">val result : Option&lt;Route&gt;</div>
<div class="tip" id="fs12">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs13">val model : Model</div>
<div class="tip" id="fs14">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs15">val query : string</div>
<div class="tip" id="fs16">property Option.Value: Route</div>
<div class="tip" id="fs17">val page : Route</div>
<div class="tip" id="fs18">val query : Linq.QueryBuilder</div>
<div class="tip" id="fs19">union case Option.None: Option&lt;&#39;T&gt;</div>

        </div>
        <div class="span3">
          <img src="https://elmish.github.io/browser/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">elmish-browser</li>
            <li><a href="https://github.com/elmish/browser">Source Code on GitHub</a></li>
            <li class="nav-header">Tutorials</li>
            <li><a href="https://elmish.github.io/browser/routing.html">Parsing routes</a></li>
            <li><a href="https://elmish.github.io/browser/queries.html">Query parameters</a></li>
            <li class="nav-header">Modules</li>
            <li><a href="https://elmish.github.io/browser/parser.html">Parser</a></li>
            <li><a href="https://elmish.github.io/browser/navigation.html">Navigation</a></li>
          </ul>
        </div>
      </div>
    </div>
  </body>
  </html>
